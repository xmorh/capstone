{% extends 'app/base.html' %}
{% block contenido %}

<div class="h-full flex flex-col items-center min-h-screen bg-gray-100 p-6">
    <h1 class="text-4xl font-bold text-gray-800 mb-4">Agendar Hora</h1>
    <p class="text-lg text-gray-600 mb-6">Seleccione la fecha que desea</p>

    <div class="w-4/5 h-64 flex-grow bg-white shadow-md rounded-lg p-4">
        <div id="calendar" class="h-full w-full"></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth', // Vista inicial
            locale: 'es', // Cambiar al idioma español
            headerToolbar: {
                left: 'prev,next',
                center: 'title',
                right: 'dayGridMonth,timeGridDay'
            },
            buttonText: {
                today: 'Hoy',
                month: 'Mes',
                week: 'Semana',
                day: 'Día',
                list: 'Lista'
            },
            events: '/api/eventos/', // API o ruta para cargar eventos si es necesario
            dateClick: function (info) {
                // Cambiar a la vista de horarios del día seleccionado
                calendar.changeView('timeGridDay', info.dateStr);
            },
            // Permitir selección de horarios
            selectable: true,
            select: function (info) {
                // Verificar si la vista activa es de horario
                const currentView = calendar.view.type;

                if (currentView === 'timeGridDay' || currentView === 'timeGridWeek') {
                    
                    const selectedDate = new Date(info.start);

                    const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
                    const localTime = selectedDate.toLocaleTimeString('es-CL', options);

                    alert(`Has seleccionado el horario: ${localTime}`);
                } else {
                    // ignora las selecciones en vistas que no sean de horario
                    console.log('No se seleccionó una hora específica.');
                }
            },
            // Opcional: Configurar un rango de tiempo en la vista diaria
            slotDuration: '00:30:00',
            slotMinTime: '09:00:00',
            slotMaxTime: '19:00:00',
            validRange: {
                start: new Date().toISOString().slice(0, 10) // Establece la fecha de hoy como el inicio
            }
        });

        calendar.render();
    });
</script>

{% endblock %}